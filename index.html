<!DOCTYPE html>

<iframe id="iframe1" src="iframe1.html"></iframe>
<iframe id="iframe2" src="iframe2.html"></iframe>
<script src="https://unpkg.com/comlink@4.4.2/dist/umd/comlink.js"></script>
<script>
  // import * as Comlink from "https://unpkg.com/comlink/dist/esm/comlink.mjs";
  // import * as Comlink from "../../../../dist/esm/comlink.mjs";
  async function main() {
    const ifr = document.querySelector("iframe");
    //await new Promise((resolve) => { console.log(resolve);(ifr.onload = resolve)});
    const f = Comlink.wrap(Comlink.windowEndpoint(ifr.contentWindow));
    f.add(1,2).then( (sum)=>{
      alert(`promise chain: 1 + 2 = ${sum}`);
     })
    alert(`5 - 2 = ${await f.substract(5, 2)}`);
  }
  function showMessage(msg) {
    alert(msg);
  }
  async function getFrameElementCSSDisplayAndReadyState() {
    var ifr = document.querySelector("iframe");
    const f = Comlink.wrap(Comlink.windowEndpoint(ifr.contentWindow));
    f.getFrameElementCSSDisplayAndReadyState().then((display, readyState) => {
      alert(`iframe: display=${display}, readyState=${readyState}`);
    }).catch((err) => {
      alert(`iframe: error in getFrameElementCSSDisplayAndReadyState: ${err}`);
    });

  }
  Comlink.expose({ showMessage }, Comlink.windowEndpoint(window));
</script>
<button id="btnAsync">call functions in iframe</button>
<button id="btnGetFrameInfo">getFrameElementCSSDisplayAndReadyState</button>
<script>
  var btn = document.getElementById("btnAsync");
  btn.addEventListener('click', e=>{
    main();
  })
  var btnGetFrameInfo = document.getElementById("btnGetFrameInfo");
  btnGetFrameInfo.addEventListener('click', e=>{
    getFrameElementCSSDisplayAndReadyState();
  })
</script>
